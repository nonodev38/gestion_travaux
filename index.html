<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>üìã Gestion Travaux</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
  <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/fr.js"></script>
  <style>
    /* ... ton CSS inchang√© ... */
    body {
      font-family: Arial, sans-serif;
      margin: 2rem;
      background: #f9f9f9;
      color: #333;
    }
    /* ... tout le reste inchang√© ... */
    .date-container {
      position: relative;
      display: flex;
      align-items: center;
    }
  
    .date-container .calendar-icon {
      position: absolute;
      left: 10px;
      font-size: 1.2em;
      pointer-events: none;
    }
  
    .date-container input {
      padding-left: 32px;
      width: 100%;
    }
  </style>
</head>
<body>

  <!-- ... ton HTML inchang√© ... -->

  <div class="form-container" id="formContainer">
    <!-- ... autres champs ... -->
    <label for="date">Date s√©lectionn√©e</label>
    <div class="date-container">
      <span class="calendar-icon">üìÖ</span>
      <input type="text" id="date" placeholder="S√©lectionnez une date" />
    </div>
    <!-- ... boutons ... -->
  </div>

  <!-- ... liste et autres boutons ... -->

  <script>
    let travaux = JSON.parse(localStorage.getItem('travaux')) || [];

    // Nouvelle fonction adapt√©e au format dd/mm/yyyy
    function parseDateDDMMYYYY(str) {
      if (!str) return null;
      const [d, m, y] = str.split('/');
      return new Date(`${y}-${m}-${d}`);
    }

    function afficherTravaux() {
      // Trier par date s√©lectionn√©e (objet Date)
      travaux.sort((a, b) => {
        const dateA = parseDateDDMMYYYY(a.dateSelection);
        const dateB = parseDateDDMMYYYY(b.dateSelection);
        return dateA - dateB;
      });

      const list = document.getElementById('travauxList');
      list.innerHTML = '';

      travaux.forEach(item => {
        const li = document.createElement('li');

        const title = document.createElement('div');
        title.className = 'title';
        title.textContent = `${item.type} ${item.numero}`;

        const subtitle = document.createElement('div');
        subtitle.className = 'subtitle';

        // Afficher la date ajout et la date s√©lectionn√©e au format fran√ßais
        const formatFr = d => {
          if (!d) return '';
          const dateObj = new Date(d);
          return dateObj.toLocaleDateString('fr-FR');
        };

        subtitle.textContent = [
          item.famille,
          item.precision,
          item.dateAjout,
          item.dateSelection
        ].filter(Boolean).join(' | ');

        const btnModif = document.createElement('button');
        btnModif.className = 'modifier-btn';
        btnModif.textContent = '‚úèÔ∏è Modifier';
        btnModif.onclick = () => modifierFiche(item.id);

        li.appendChild(title);
        li.appendChild(subtitle);
        li.appendChild(btnModif);

        list.appendChild(li);
      });
    }

    function toggleForm() {
      const form = document.getElementById('formContainer');
      const isCurrentlyHidden = form.style.display === 'none' || !form.style.display;

      if (isCurrentlyHidden) {
        form.style.display = 'block';

        // Mettre la date du jour au format dd/mm/yyyy
        const dateInput = document.getElementById('date');
        const today = new Date();
        const yyyy = today.getFullYear();
        const mm = String(today.getMonth() + 1).padStart(2, '0');
        const dd = String(today.getDate()).padStart(2, '0');
        dateInput.value = `${dd}/${mm}/${yyyy}`;
      } else {
        form.style.display = 'none';
        clearForm();
      }
    }

    function clearForm() {
      document.getElementById('ficheId').value = '';
      document.getElementById('type').value = 'MH';
      document.getElementById('numero').value = '';
      document.getElementById('famille').value = 'Deco';
      document.getElementById('precision').value = '';
      document.getElementById('date').value = '';
      document.getElementById('btnSupprimer').style.display = 'none';
    }

    function validerFiche() {
      const id = document.getElementById('ficheId').value;
      const type = document.getElementById('type').value;
      const numero = document.getElementById('numero').value.trim();
      const famille = document.getElementById('famille').value;
      const precision = document.getElementById('precision').value.trim();
      const dateSelection = document.getElementById('date').value;
      const dateAjout = new Date().toLocaleDateString('fr-FR');

      if (!numero || !dateSelection) {
        alert("Le num√©ro et la date sont requis.");
        return;
      }

      if (id) {
        // modification
        const i = travaux.findIndex(t => t.id == id);
        travaux[i] = { id: Number(id), type, numero, famille, precision, dateAjout: travaux[i].dateAjout, dateSelection };
      } else {
        // ajout
        const newId = travaux.length ? Math.max(...travaux.map(t => t.id)) + 1 : 1;
        travaux.push({ id: newId, type, numero, famille, precision, dateAjout, dateSelection });
      }

      localStorage.setItem('travaux', JSON.stringify(travaux));
      afficherTravaux();
      toggleForm();
      clearForm();
    }

    function supprimerFiche() {
      const id = document.getElementById('ficheId').value;
      if (confirm("Supprimer cette fiche ?")) {
        travaux = travaux.filter(t => t.id != id);
        localStorage.setItem('travaux', JSON.stringify(travaux));
        afficherTravaux();
        toggleForm();
        clearForm();
      }
    }

    function supprimerTousTravaux() {
      if (confirm("‚ùó Cette action supprimera tous les travaux enregistr√©s dans le navigateur. √ätes-vous s√ªr ?")) {
        localStorage.removeItem('travaux');
        travaux = [];
        afficherTravaux();
        alert("Tous les travaux ont √©t√© supprim√©s !");
      }
    }

    function modifierFiche(id) {
      const f = travaux.find(t => t.id === id);
      if (!f) return;
      document.getElementById('ficheId').value = f.id;
      document.getElementById('type').value = f.type;
      document.getElementById('numero').value = f.numero;
      document.getElementById('famille').value = f.famille;
      document.getElementById('precision').value = f.precision;
      document.getElementById('date').value = f.dateSelection;
      document.getElementById('btnSupprimer').style.display = 'inline-block';
      document.getElementById('formContainer').style.display = 'block';
    }

    // Initialiser Flatpickr avec le format fran√ßais
    flatpickr("#date", {
      dateFormat: "d/m/Y", // Format fran√ßais : jour/mois/ann√©e
      defaultDate: "today",
      locale: "fr"
    });

    // Affichage initial
    afficherTravaux();
  </script>
</body>
</html>
